<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
  </head>
  <body>

    <div id="login">
      Please enter the buzzer password:<br />
      <form id="loginForm">
        <input id="loginPassword" type="password">
        <input type="submit">
      </form>
    </div>

    <div id="authenticated">
      <button onClick="buzzer()">Buzzer</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="./jquery-1.11.1.js"></script>
    <script>
      var socket, token;
      $('#authenticated').hide();
      $('#loginForm').submit(function() {
        $.post('/buzzerAuth', {
          password: $('#loginPassword').val()
        }, function(tk) {
          token = tk;
          socket = io('/buzzer', {
            query: "token=" + token
          });

          socket.on('connect', function() {
            $('#login').hide();
            $('#authenticated').show();
          })
        })
        return false;
      })

      function buzzer() {
        socket.emit('buzzer')
      }
    </script>
  </body>
</html>
